{% extends "govuk-prototype-kit/layouts/govuk-branded.html" %}

{% block pageTitle %}
Facility – {{ serviceName }} – GOV.UK Prototype Kit
{% endblock %}

{% block header %}
  {% include "includes/head.html" %}
{% endblock %}

{% block pageScripts %}
  {% include "includes/scripts.html" %}
{% endblock %}

{% block beforeContent %}
  {% include "includes/phase-banner.html" %}


  {{ govukBackLink({
    text: "Back",
    href: "facility-list"
  }) }}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <span class="govuk-caption-l">Bank reference {{ data['facility-5-ref'] }}</span>
    <h1 class="govuk-heading-xl">
      {{ data['facility-5-name'] }}
    </h1>
    <h2 class="govuk-heading-l">Overview</h2>
    <dl class="govuk-summary-list govuk-!-margin-bottom-9">
      
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key govuk-!-width-one-half">
          Exporter
        </dt>
        <dd class="govuk-summary-list__value govuk-!-width-one-half">
          {{ data['facility-5-name'] }}
        </dd>
      </div>
      
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Bank reference
        </dt>
        <dd class="govuk-summary-list__value">
          {{ data['facility-5-ref'] }}
        </dd>
      </div>
      
      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          UKEF facility ID
        </dt>
        <dd class="govuk-summary-list__value">
          {{ data['facility-5-ukef-id'] }}
        </dd>
      </div>
      
     

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Product type
        </dt>
        <dd class="govuk-summary-list__value">
          General Export Facility
        </dd>
      </div>

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Facility description
        </dt>
        <dd class="govuk-summary-list__value">
          Cash
        </dd>
      </div>

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Facility base currency
        </dt>
        <dd class="govuk-summary-list__value">
          GBP
        </dd>
      </div>

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Cover end date
        </dt>
        <dd class="govuk-summary-list__value">
          23 July 2025
        </dd>
      </div>

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          1 year probability of default (reported semi-annually)
        </dt>
        <dd class="govuk-summary-list__value">
          Reported in July
        </dd>
      </div>

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Flag: 90 days still no utilisation (from date of facility letter)
        </dt>
        <dd class="govuk-summary-list__value">
          Utilised
        </dd>
      </div>
      </dl>


      <h2 class="govuk-heading-l">Value and exposure</h2>
      <dl class="govuk-summary-list govuk-!-margin-bottom-9">
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-!-width-one-half">
            Bank facility limit
          </dt>
          <dd class="govuk-summary-list__value govuk-!-width-one-half">
            GBP {{ data['facility-5-limit'] }}
          </dd>
        </div>
  
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            UKEF cover
          </dt>
          <dd class="govuk-summary-list__value">
            {{ data['facility-5-cover'] }}
          </dd>
        </div>
  
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            UKEF's maximum exposure
          </dt>
          <dd class="govuk-summary-list__value">
            GBP {{ data['facility-5-limit'] }}
          </dd>
        </div>
      </dl> 



      <h2 class="govuk-heading-l">
        Previously reported utilisation and premium
      </h2>
        <dl class="govuk-summary-list govuk-!-margin-bottom-9">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">
              Report up to
            </dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-half">
              {{ data['end-previous-month'] }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Facility updated
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['1-month-ago'] }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Bank facility utilisation
            </dt>
            <dd class="govuk-summary-list__value">
              GBP {{ data['facility-5-utilisation'] }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              UKEF's exposure
            </dt>
            <dd class="govuk-summary-list__value">
              GBP {{ data['facility-5-exposure'] }}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Premium payable to UKEF
            </dt>
            <dd class="govuk-summary-list__value">
              GBP {{ data['facility-5-paid'] }} 
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Premium accrued
            </dt>
            <dd class="govuk-summary-list__value">
              GBP {{ data['facility-5-accrued'] }} 
            </dd>
          </div>
        </dl>
        
        {% if 'no' in data['facility-5-updated'] %}
      <!-- Display the empty form-->
        <!-- Showing blank fields to be updated with latest data -->

        <form action="/facility5/index#updated" method="post" novalidate>
          <input type="hidden" name="facility-5-updated" value="yes">

        <h2 class="govuk-heading-l">Update utilisation and premium</h2>

        <p class="govuk-body">Enter details for the {{ data['report-month'] }} report.</p>
          

        {% set utilisationHtml %} 
        Bank facility utilisation on {{ data['end-current-month'] }}
        {% endset %}

        {{ govukInput({
        id: "facility-5new-utilisation",
        name: "facility-5new-utilisation",
        label: {
          html: utilisationHtml,
          classes: "govuk-label--s",
          isPageHeading: false
        },
        prefix: {
          text: "GBP"
        },
        classes: "govuk-input--width-10",
        spellcheck: false
      }) }}

      {{ govukInput({
        id: "facility-5new-paid",
        name: "facility-5new-paid",
        label: {
          text: "Premium payable to UKEF",
          classes: "govuk-label--s",
          isPageHeading: false
        },
        prefix: {
          text: "GBP"
        },
        classes: "govuk-input--width-10",
        spellcheck: false
      }) }}

      {{ govukInput({
        id: "facility-5new-accrued",
        name: "facility-5new-accrued",
        label: {
          text: "Premium accrued",
          classes: "govuk-label--s",
          isPageHeading: false
        },
        prefix: {
          text: "GBP"
        },
        classes: "govuk-input--width-10",
        spellcheck: false
      }) }}

        <div class="govuk-button-group">
          {{ govukButton({
            text: "Save"
          }) }}
          <a class="govuk-link govuk-link--no-visited-state" href="/facility-list">Cancel</a>
        </div>
      </form>
      
      <!-- Show once updates have been saved -->

      {% elseif 'yes' in data['facility-5-updated'] %}

      <form action="/facility5/index#update" method="post" novalidate>
        <input type="hidden" name="facility-5-updated" value="edit">

      <h2 class="govuk-heading-l" id="updated">Updated utilisation and premium</h2>
      <p class="govuk-body">You can make changes to the updates up until report is submitted to UKEF.</p>
        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">
              Report up to
            </dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-quarter">
              {{ data['end-current-month'] }}
            </dd>
            <dd class="govuk-summary-list__actions govuk-!-width-one-quarter">
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
             Facility updated
            </dt>
            <dd class="govuk-summary-list__value">
              {{ data['todays-date'] }}
            </dd>
            <dd class="govuk-summary-list__actions">
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Bank facility utilisation
            </dt>
            <dd class="govuk-summary-list__value">
              GBP {{ data['facility-5new-utilisation'] }}
            </dd>
            <dd class="govuk-summary-list__actions">
              <a class="govuk-link" href="utilisation">
                Change<span class="govuk-visually-hidden"> name</span>
              </a>
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              UKEF's exposure
            </dt>
            <dd class="govuk-summary-list__value">
              GBP  {{ data['facility-5new-utilisation'] * 0.8  }}     
            </dd>
            <dd class="govuk-summary-list__actions">
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Premium payable to UKEF
            </dt>
            <dd class="govuk-summary-list__value">
              GBP {{ data['facility-5new-paid'] }} 
            </dd>
            <dd class="govuk-summary-list__actions">
              <a class="govuk-link" href="#">
                Change<span class="govuk-visually-hidden"> name</span>
              </a>
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Premium accrued
            </dt>
            <dd class="govuk-summary-list__value">
              GBP {{ data['facility-5new-accrued'] }} 
            </dd>
            <dd class="govuk-summary-list__actions">
              <a class="govuk-link" href="#">
                Change<span class="govuk-visually-hidden"> name</span>
              </a>
            </dd>
          </div>
        </dl>

        </form>

        <!-- Show when changes want to be made to entered amounts
            text fields with already entered values -->

        {% elseif 'edit' in data['facility-5-updated'] %}
        
        <form action="/facility-list" method="post" novalidate>
          <input type="hidden" name="facility-5-updated" value="yes">

        <h2 class="govuk-heading-l" id="update">Update utilisation and premium</h2>
        
        <p class="govuk-body">Enter details for the {{ data['report-month'] }} report.</p>

        {% set utilisationHtml %} 
        Bank facility utilisation on {{ data['end-current-month'] }}
        {% endset %}

        {{ govukInput({
        id: "facility-5new-utilisation",
        name: "facility-5new-utilisation",
        label: {
          html: utilisationHtml,
          classes: "govuk-label--s"
        },
        prefix: {
          text: "GBP"
        },
        value: data['facility-5new-utilisation'],
        classes: "govuk-input--width-10",
        spellcheck: false
      }) }}

      {{ govukInput({
        id: "facility-5new-paid",
        name: "facility-5new-paid",
        label: {
          text: "Premium payable to UKEF",
          classes: "govuk-label--s",
          isPageHeading: false
        },
        prefix: {
          text: "GBP"
        },
        classes: "govuk-input--width-10",
        value: data['facility-5new-paid'],
        spellcheck: false
      }) }}

      {{ govukInput({
        id: "facility-5new-accrued",
        name: "facility-5new-accrued",
        label: {
          text: "Premium accrual",
          classes: "govuk-label--s",
          isPageHeading: false
        },
        prefix: {
          text: "GBP"
        },
        classes: "govuk-input--width-10",
        value: data['facility-5new-accrued'],
        spellcheck: false
      }) }}
  
        <div class="govuk-button-group">
          {{ govukButton({
            text: "Save and continue"
          }) }}
          <a class="govuk-link govuk-link--no-visited-state" href="/facility-list">Cancel</a>
        </div>
    
        {% endif %}

      </form>
  </div>
</div>


<!--<form action="/facility-list" method="post" novalidate>
  <input type="hidden" name="facility-5-updated" value="yes">
    {{ govukButton({
      text: "Update facility",
      value: data['facility-5-updated']
    }) }}
</form>-->


<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

  </div>
</div>

{% endblock %}
